import{a as m}from"./axios-Bo0ATomq.js";import{_ as I,c,a as n,F as u,f,n as g,d as p,b as v,g as C,v as U,h as _,T as E,t as d,o as l,e as P,w as k,i as M,r as H}from"./index-Co1rkqzz.js";const x="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAHtSURBVHgBrZRLKERhGIb/OXNrJprRzIJYTLEQsjDZTWEv2Vgrl7KgbGSjkIUNJUsl2UgpImxIbgukWCvXRGgoC5Np5hzPb85ME8ecTuard97/8n3vef/vP2eEsBiKonTZ7fZNuN9msz2wpMKHrHVYEvL5fEUU7jHUEDuW/BPsL9osaM6CtAtZLGvfEd8AT4lEooalSjMRv8PhGAsEAvU/3ETBOEKT7B9lObxy5BCrBuuapj1Go9EyuUDBB5hSVdUN98B+kClgbfMvsRB40Z+6Aqu4OXM6ne2Mr4Rx/07hgl9K4XDYyeZ1VuITYnNgWDo0ENK44SXZnm+XBu6GwFh6Qo9GOZbC0fvAmy6ShJ+Zy9teBfuZ/Gwlr9dbF4vFukn8nuNqBPIgOJi6VHHO2p1sATk+nJWD13g8/tsW/ekkeT59FMYTuqD2R8+W4RKRI65J2tGTL3KIqbRhQJhEgy50BG49Hk+bgdAn2HK5XNVmYoI+NMsi+JKnj0i3BkdcYK/JTEuRP8lkskWfn/AJlYrUe5gJxPYR245EIgdmgsLtdldIZ9IFRY0U3zOeAzOgF1QJC2HH3SsiRbwGNyACirmQXR40jdstkfpirIX8EqCQn4BrxT8jxJHXRJ5C4YVu5dhLIl8h/0WCwWChyFN8AXrqxL/LyMv8AAAAAElFTkSuQmCC",T={data(){return{commentInfo:[],currentPage:1,commentsPerPage:5,isModalOpen:!1,comment:"",userInfo:[],filters:[],showTopHashtags:!0,isLightMode:localStorage.getItem("light-mode")==="true"}},mounted(){this.username=localStorage.getItem("username"),this.getComments(),this.getAllUserInfo()},computed:{totalPages(){return Math.ceil(this.commentInfo.length/this.commentsPerPage)},paginatedComments(){const e=(this.currentPage-1)*this.commentsPerPage,t=e+this.commentsPerPage;return this.commentInfo.slice(e,t)}},methods:{async getComments(){try{const t=await m.get("http://localhost/api/v1/comments");this.commentInfo=t.data,this.commentInfo.sort((s,a)=>s.created_at>a.created_at?-1:s.created_at<a.created_at?1:s.id-a.id),this.commentInfo.forEach(s=>{this.formatComment(s.texto)}),console.log(this.commentInfo)}catch(e){console.error("Error fetching comments:",e)}},formatDate(e){const t=new Date(e);return`${t.getDate()}/${t.getMonth()+1}/${t.getFullYear()}`},nextPage(){this.currentPage<this.totalPages&&this.currentPage++},previousPage(){this.currentPage>1&&this.currentPage--},toggleModal(){this.isModalOpen=!this.isModalOpen},async submit(){const e=localStorage.getItem("username");try{const t="http://localhost:80/api/v1/comments",s={username:e,texto:this.comment},a=await m.post(t,s);console.log("Respuesta del servidor:",a.data),this.getComments()}catch{}},async getAllUserInfo(){try{(await m.get("http://localhost/api/v1/users")).data.forEach(s=>{this.userInfo[s.username]=s})}catch(e){console.error("Error fetching user information:",e)}},formatComment(e){return e.split(" ").map(a=>a.startsWith("#")?(this.filters.includes(a)||this.filters.push(a),`<span class="hashtag">${a}</span>`):a).join(" ")},saveFriendAndNavigate(e){localStorage.setItem("selectedFriend",e),this.$router.push("/other-user")},sortByWord(e){this.commentInfo=[...this.commentInfo].sort((t,s)=>s.id-t.id),this.commentInfo.sort((t,s)=>t.texto.includes(e)&&!s.texto.includes(e)?-1:!t.texto.includes(e)&&s.texto.includes(e)?1:0)},getUserImage(e){return this.userInfo[e]?this.userInfo[e].idicon:"@/assets/icons/default-user-image.png"},toggleHashtags(){this.showTopHashtags?this.showRecentHashtags():this.showTopUsedHashtags(),this.showTopHashtags=!this.showTopHashtags},async showRecentHashtags(){try{const t=await m.get("http://localhost/api/v1/comments");this.commentInfo=t.data;const s=[];this.commentInfo.slice().reverse().forEach(a=>{a.texto.split(" ").forEach(o=>{o.startsWith("#")&&!s.includes(o)&&s.push(o)}),s.length}),this.filters=s}catch(e){console.error("Error fetching comments:",e)}},async showTopUsedHashtags(){try{const t=await m.get("http://localhost/api/v1/comments");this.commentInfo=t.data;const s={};this.commentInfo.forEach(i=>{i.texto.split(" ").forEach(h=>{h.startsWith("#")&&(s[h]=(s[h]||0)+1)})});const a=Object.keys(s).sort((i,o)=>s[o]-s[i]).slice(0,5);this.filters=a}catch(e){console.error("Error fetching comments:",e)}}}},b={class:"homepage"},y={class:"Comentarios"},B={class:"image-container"},R=["src"],N={class:"content-container"},w={class:"post-header"},L={class:"date"},W=["innerHTML"],S=["disabled"],F=n("img",{src:x,alt:"pluma"},null,-1),J=[F],O=["disabled"],Y={class:"buttons-modal"},D={class:"right-side"},V=["onClick"];function X(e,t,s,a,i,o){const h=H("router-link");return l(),c("div",b,[n("div",y,[(l(!0),c(u,null,f(o.paginatedComments,r=>(l(),c("article",{key:r.id,class:g(["Mensaje",{"light-mode-comment":i.isLightMode}])},[n("div",B,[n("img",{src:o.getUserImage(r.username),alt:"User icon",class:"user-icon"},null,8,R)]),n("div",N,[n("header",w,[P(h,{onClick:A=>o.saveFriendAndNavigate(r.username),to:"/other-user",class:"username"},{default:k(()=>[M(d(r.username),1)]),_:2},1032,["onClick"]),n("p",L,d(o.formatDate(r.created_at)),1)]),n("p",{class:"post-content",innerHTML:o.formatComment(r.texto)},null,8,W)])],2))),128)),n("div",{class:g(["buttons",{"light-mode-buttons":i.isLightMode}])},[n("button",{onClick:t[0]||(t[0]=(...r)=>o.previousPage&&o.previousPage(...r)),disabled:i.currentPage===1,class:"pagination"},"Previous",8,S),e.username?(l(),c("button",{key:0,onClick:t[1]||(t[1]=(...r)=>o.toggleModal&&o.toggleModal(...r)),class:"write"},J)):p("",!0),n("button",{onClick:t[2]||(t[2]=(...r)=>o.nextPage&&o.nextPage(...r)),disabled:i.currentPage===o.totalPages,class:"pagination"},"Next",8,O)],2),(l(),v(E,{to:"body"},[i.isModalOpen?(l(),c("div",{key:0,class:g(["modal",{"light-mode-modal":i.isLightMode}])},[n("form",null,[n("label",null,[C(n("textarea",{"onUpdate:modelValue":t[3]||(t[3]=r=>i.comment=r),placeholder:"Use me to comment!"},null,512),[[U,i.comment]])])]),n("div",Y,[n("button",{onClick:t[4]||(t[4]=_((...r)=>o.submit&&o.submit(...r),["prevent"]))},"Send"),n("button",{onClick:t[5]||(t[5]=(...r)=>o.toggleModal&&o.toggleModal(...r))},"Close")])],2)):p("",!0)]))]),n("div",D,[n("div",{class:g(["comments-filter",{"light-mode-rightside":i.isLightMode}])},[n("button",{onClick:t[6]||(t[6]=(...r)=>o.toggleHashtags&&o.toggleHashtags(...r)),class:"filter-title"},d(i.showTopHashtags?"Top Hastags":"Last Hastags"),1),n("ul",null,[(l(!0),c(u,null,f(i.filters,r=>(l(),c("li",{key:r},[n("p",{onClick:A=>o.sortByWord(r),class:"filter"},d(r),9,V)]))),128))])],2)])])}const j=I(T,[["render",X]]);export{j as default};
